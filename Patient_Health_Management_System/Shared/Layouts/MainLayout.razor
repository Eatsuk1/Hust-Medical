@inherits LayoutComponentBase
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject NavigationManager NavigationManager
@inject IUserService UserService

<MudThemeProvider/>
<MudDialogProvider />
<MudSnackbarProvider />
@*<NavMenu />*@

<div style="background-image: linear-gradient(to top, #6e3fc5, #a799c1); margin-bottom: 20px">
	<TopBar UserName="@userName"/>
</div>
<div style="display:flex; justify-content:center">
	@Body
</div>

@code {

	private static string userName = string.Empty;

	protected override async Task OnInitializedAsync()
	{
		var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
		if (authState.User.Identity.IsAuthenticated)
		{
			var userId = authState.User.Claims
			.Where(c => c.Type.Equals(ClaimTypes.NameIdentifier))
			.SingleOrDefault().Value;
			userName = await UserService.GetUserNameByUserId(userId);
		}
		else NavigationManager.NavigateTo("/auth/login");
	}
}
